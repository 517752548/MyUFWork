<?xml version="1.0" encoding="UTF-8"?>
<project name="scribe-recv-server" basedir="." default="package">
	<property file="build.properties" />
	<tstamp>
		<format property="build_date" pattern="yyyy-MM-dd HH:mm" />
	</tstamp>
	<path id="lib.path">
		<fileset dir="${lib.dir}">
			<include name="**/*.zip" />
			<include name="**/*.jar" />
		</fileset>
	</path>
	<pathconvert property="mf.classpath" pathsep=" ">
		<path refid="lib.path"/>
		<mapper>
			<chainedmapper>
				<flattenmapper/>
				<globmapper from="*.jar" to="lib/*.jar"/>
			</chainedmapper>
		</mapper>
	</pathconvert>
				
	<path id="class.path">
		<fileset dir="${lib.dir}">
			<include name="**/*.zip" />
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="${build.dir}"/>
	</path>
	<target name="initdir" depends="clean">
		<tstamp />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.dir}" />
	</target>
	<target name="clean" description="delete the src,build,dist dir">
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}" />
	</target>
	<target name="package" depends="initdir">
		<echo message="compile java soruce" />
		<javac srcdir="${basedir}/interface/fb303/if/gen-java" destdir="${build.dir}" encoding="UTF-8" classpathref="lib.path" source="1.6" target="1.6" debug="true"/>
		<javac srcdir="${basedir}/interface/gen-java" destdir="${build.dir}" encoding="UTF-8" classpathref="lib.path"  source="1.6" target="1.6" debug="true"/>
		<javac srcdir="${src.dir}" destdir="${build.dir}" encoding="UTF-8" classpathref="class.path"   source="1.6" target="1.6" debug="true"/>
		<jar destfile="${dist.dir}/scribe-recv-server.jar">
			<fileset dir="${build.dir}"/>
			<manifest>
				<attribute name="Version" value="${version}" />
				<attribute name="Build-Date" value="${build_date}" />
				<attribute name="Class-Path" value=". ${mf.classpath}" />
				<attribute name="Main-Class" value="com.imop.scribe.receiver.Main"/>
			</manifest>
		</jar>
		<copy todir="${dist.dir}">
			<fileset dir="${basedir}/resource">
				<include name="**/*.cfg"/>
				<include name="**/*.properties"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}/lib">
			<fileset dir="${basedir}/lib">
				<include name="**/*.jar"/>
			</fileset>
		</copy>
		<zip destfile="${dist.dir}/scribe-recv-server.zip">
            <fileset dir="${dist.dir}">
                <include name="**/*.*" />
            </fileset>
        </zip>
	</target>
</project>
