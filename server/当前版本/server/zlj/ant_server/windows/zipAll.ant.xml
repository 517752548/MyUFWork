<?xml version="1.0" encoding="UTF-8" ?>
<project name="zipAll.ant" basedir="." default="root">
	<!-- import -->
	<import file="zipAll.def.xml" />

<!--
// 版本号信息开始
// 注意: 版本号信息由命令行参数给出!!
///////////////////////////////////////////////////////////////////
//-->
	<!-- 大版本号  -->
	<property name="largeVer" value="cmdArgs" />
	<!-- 代码版本号  -->
	<property name="codeRev" value="cmdArgs" />
	<!-- 语言版本 -->
	<property name="langName" value="cmdArgs" />
	<!-- 多语言资源版本号 -->
	<property name="langRev" value="cmdArgs" />

	<!-- 最终版本号及打包目录 -->
	<property name="pubVer" 
		value="${largeVer}.${codeRev}.${langName}.${langRev}"  />
	<property name="tmpDir" 
		value="${tempdir}/${pubVer}/temp" />
	<property name="finalDir" 
		value="${tempdir}/${pubVer}/final" />

<!--
// 开始构建
///////////////////////////////////////////////////////////////////
//-->
	<target name="root">
		<antcall target="createVer" />
		<antcall target="createZip" />
	</target>

	<!-- 创建版本文件 -->
	<target name="createVer">
		<!-- 事先删除版本文件 -->
		<delete file="${finalDir}/version" />
		<!-- 服务器版本号 -->
		<echo message="server_version ${pubVer}&#10;" 
			file="${finalDir}/version" 
			append="true" />
		<!-- 客户端版本号 -->
		<echo message="client_version ${pubVer}&#10;" 
			file="${finalDir}/version" 
			append="true" />
		<!-- 数据库版本号 -->
		<echo message="db_version ${pubVer}&#10;" 
			file="${finalDir}/version" 
			append="true" />
		<!-- 资源版本号 -->
		<echo message="resource_version ${pubVer}&#10;" 
			file="${finalDir}/version" 
			append="true" />
	</target>

	<!-- 创建 zip 文件 -->
	<target name="createZip">
		<zip destfile="${finalDir}/${pubVer}.zip">
			<fileset dir="${finalDir}">
				<include name="**/*" />
			</fileset>
		</zip>
	</target>

</project>
