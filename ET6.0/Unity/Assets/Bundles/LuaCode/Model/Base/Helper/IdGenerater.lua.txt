-- Generated by CSharp.lua Compiler
local System = System
local SystemInteropServices = System.Runtime.InteropServices
local ET
System.import(function (out)
  ET = out.ET
end)
System.namespace("ET", function (namespace)
  namespace.struct("IdStruct", function (namespace)
    local ToLong, ToString, __ctor1__, __ctor2__
    __ctor1__ = function (this, process, time, value)
      if process == nil then
        return
      end
      this.Process = process
      this.Time = time
      this.Value = value
    end
    __ctor2__ = function (this, id)
      local result = System.toUInt64(id)
      this.Process = System.toInt32(System.band(result, 0x03ffff))
      result = System.sr(result, 18)
      this.Value = System.toUInt16(System.band(result, (65535 --[[UInt16.MaxValue]])))
      result = System.sr(result, 16)
      this.Time = System.toUInt32(result)
    end
    ToLong = function (this)
      local result = 0
      result = System.bor(result, System.toUInt32(this.Process))
      result = System.bor(result, System.sl(this.Value, 18))
      result = System.bor(result, System.sl(this.Time, 34))
      return System.toInt64(result)
    end
    ToString = function (this)
      return "process: " .. this.Process .. ", time: " .. this.Time .. ", value: " .. this.Value
    end
    return {
      Time = 0,
      Value = 0,
      Process = 0,
      ToLong = ToLong,
      ToString = ToString,
      __ctor__ = {
        __ctor1__,
        __ctor2__
      }
    }
  end)

  namespace.struct("InstanceIdStruct", function (namespace)
    local ToLong, ToString, __ctor1__, __ctor2__
    __ctor1__ = function (this, id)
      if id == nil then
        return
      end
      local result = System.toUInt64(id)
      this.Process = System.toInt32(System.band(result, 0x03ffff))
      result = System.sr(result, 18)
      this.Value = result
    end
    __ctor2__ = function (this, process, value)
      this.Process = process
      this.Value = value
    end
    ToLong = function (this)
      local result = 0
      result = System.bor(result, System.toUInt32(this.Process))
      result = System.bor(result, System.sl(this.Value, 18))
      return System.toInt64(result)
    end
    ToString = function (this)
      return "process: " .. this.Process .. ", value: " .. this.Value
    end
    return {
      Value = 0,
      Process = 0,
      ToLong = ToLong,
      ToString = ToString,
      __ctor__ = {
        __ctor1__,
        __ctor2__
      }
    }
  end)

  namespace.class("IdGenerater", function (namespace)
    local process, value, setProcess, getProcess, GetProcess, MaxConfigSceneId, GenerateProcessSceneId, GenerateInstanceId, 
    GenerateId, class
    process = 0
    value = 0
    setProcess = function (value)
      process = value
    end
    getProcess = function ()
      return process
    end
    GetProcess = function (v)
      return System.new(ET.IdStruct, 2, v).Process
    end
    MaxConfigSceneId = 1024000 --[[1024 * 1000]]
    GenerateProcessSceneId = function ()
      local instanceIdStruct = System.new(ET.InstanceIdStruct, 2, process, 0)
      return instanceIdStruct:ToLong()
    end
    GenerateInstanceId = function ()
      local default = MaxConfigSceneId + 1
      MaxConfigSceneId = default
      local instanceIdStruct = System.new(ET.InstanceIdStruct, 2, process, default)
      return instanceIdStruct:ToLong()
    end
    GenerateId = function ()
      local time = ET.TimeHelper.ClientNowSeconds()
      if time ~= class.lastTime then
        value = 0
        class.lastTime = time
      end

      local default = value + 1
      value = default
      if default > 65534 --[[ushort.MaxValue - 1]] then
        ET.Log.Error("id is not enough! value: " .. value)
      end

      if time > 2147483647 --[[Int32.MaxValue]] then
        ET.Log.Error("time > int.MaxValue value: " .. time)
      end

      local idStruct = ET.IdStruct(process, System.toUInt32(time), System.toUInt16(value))
      return idStruct:ToLong()
    end
    class = {
      setProcess = setProcess,
      getProcess = getProcess,
      GetProcess = GetProcess,
      GenerateProcessSceneId = GenerateProcessSceneId,
      lastTime = 0,
      GenerateInstanceId = GenerateInstanceId,
      GenerateId = GenerateId
    }
    return class
  end)
end)
