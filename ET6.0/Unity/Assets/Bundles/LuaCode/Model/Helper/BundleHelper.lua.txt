-- Generated by CSharp.lua Compiler
local System = System
local SystemIO = System.IO
local UnityEngine = UnityEngine
local ET
local ETEventType
System.import(function (out)
  ET = out.ET
  ETEventType = ET.EventType
end)
System.namespace("ET", function (namespace)
  namespace.class("BundleHelper", function (namespace)
    local DownloadBundle, GetBundleMD5
    DownloadBundle = function (url)
      return System.async(function (async, url)
        if ET.Define.IsAsync then
          System.try(function ()
            System.using(ET.Game.getScene():AddComponent2(ET.BundleDownloaderComponent), function (bundleDownloaderComponent)
              async:Await(bundleDownloaderComponent:StartAsync(url))

              local default = ETEventType.LoadingBegin()
              default.Scene = ET.Game.getScene()
              ET.Game.getEventSystem():Publish(default, ETEventType.LoadingBegin)

              async:Await(bundleDownloaderComponent:DownloadAsync(url))
            end)

            ET.Game.getEventSystem():Publish(ETEventType.LoadingFinish(), ETEventType.LoadingFinish)

            ET.Game.getScene():GetComponent(ET.ResourcesComponent):LoadOneBundle("StreamingAssets")
            ET.ResourcesComponent.AssetBundleManifestObject = System.cast(UnityEngine.AssetBundleManifest, ET.Game.getScene():GetComponent(ET.ResourcesComponent):GetAsset("StreamingAssets", "AssetBundleManifest"))
          end, function (default)
            local e = default
            ET.Log.Error1(e)
          end)
        end
      end, nil, url)
    end
    GetBundleMD5 = function (streamingVersionConfig, bundleName)
      local path = SystemIO.Path.Combine(ET.PathHelper.getAppHotfixResPath(), bundleName)
      if SystemIO.File.Exists(path) then
        return ET.MD5Helper.FileMD5(path)
      end

      if streamingVersionConfig.FileInfoDict:ContainsKey(bundleName) then
        return streamingVersionConfig.FileInfoDict:get(bundleName).MD5
      end

      return ""
    end
    return {
      DownloadBundle = DownloadBundle,
      GetBundleMD5 = GetBundleMD5
    }
  end)
end)
