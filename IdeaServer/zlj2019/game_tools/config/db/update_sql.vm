SET CHARACTER_SET_CLIENT=utf8;
SET CHARACTER_SET_CONNECTION=utf8;

USE `tr_${server_id}`;
update t_db_version set version='${version}',updateTime=now();
delete from t_item_info where deleted=1;

#if($hasAddColumn)
drop procedure if exists schema_change;
delimiter ';;';
create procedure schema_change() begin  

#foreach( $module in $modules )
if exists (select * from information_schema.columns where table_schema='tr_${server_id}' and table_name = '${module.tableName}' and column_name = '${module.columnName}') then  
        alter table tr_${server_id}.${module.tableName} drop column ${module.columnName};
end if; 
alter table tr_${server_id}.${module.tableName} add column ${module.columnName} ${module.columnType}#if($module.columnLen>0)(${module.columnLen})#end #if($module.notNull)NOT NULL#end #if($module.columnDefault!="")DEFAULT ${module.columnDefault}#end;

#end
end;;
delimiter ';';
call schema_change();
drop procedure if exists schema_change;
#end

#foreach( $spec in $specList )
${spec.desc}
#end
